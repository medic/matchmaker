<!DOCTYPE html> 
<html>
<head>
	<!-- SITE INFO -->
	<meta charset="utf-8">
	<title>CONSTRAINTS /mm</title>
	<meta name="description" content="Hello thar">
	<!-- END SITE INFO -->
	
	<!-- STYLE SHEETS -->
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="bootstrap.min.css">
	<!-- END STYLE SHEETS -->
   
   <link rel="stylesheet" href="jquery.dropdown.css" />

   
	<!-- JAVASCRIPT -->	
	<script src="js/jquery-1.10.2.min.js"></script>
	<script src="bootstrap.min.js"></script>
	<script src="jquery.dropdown.js"></script>
	<!-- END JAVASCRIPT -->
	
<script>

	// INITIALIZE category & constraint arrays while document is loading
	var phoneCats,
		compCats,
		allCats,
		constraints; 
	
	if (!phoneCats) {
		$.getJSON("phoneCats.json", function(data) {
			phoneCats = localStorage.setItem('phoneCats', JSON.stringify(data));	
		});
	} 
	
	if (!compCats) {
		$.getJSON("compCats.json", function(data) {
			compCats = localStorage.setItem('compCats', JSON.stringify(data));				
		});
	}
	
	if (!allCats) {
		$.getJSON("allCats.json", function(data) {
			allCats = localStorage.setItem('allCats', JSON.stringify(data));				
		});
	} 
	
	if (!constraints) {
		$.getJSON("constraints.json", function(data) {
			constraints = localStorage.setItem('constraints', JSON.stringify(data));				
		});
	}
		

$(document).ready(function(){

	checkMsgType(); // default behavior of categories on load
	
	// DROPDOWN: Phone --> Computer
	$("img#phone").click(function() {
		$("img#selected").attr("src", "img/phone.png");	
		checkMsgType(); // load the categories
	});
	
	// DROPDOWN: Computer --> Phone
	$("img#computer").click(function() {
		$("img#selected").attr("src", "img/computer.png");	
		checkMsgType(); // load the categories
	});
	
	// DROPDOWN: Phone <--> Computer
	$("img#both").click(function() {
		$("img#selected").attr("src", "img/both.png");	
		checkMsgType(); // load the categories
	});
	
	
	function checkMsgType() {
		switch ($("img#selected").attr("src")) {
			case "img/phone.png":
				phoneCats = JSON.parse(localStorage.getItem('phoneCats'));
				loadCategories(phoneCats);
				break;
			case "img/computer.png":
				compCats = JSON.parse(localStorage.getItem('compCats'));
				loadCategories(compCats);
				break;
			case "img/both.png":
				allCats = JSON.parse(localStorage.getItem('allCats'));
				loadCategories(allCats);
				break;
			default:
				alert('Something fishy is happening!');
		}
	}
	
	
	function loadCategories(array) {			
		$("section#categories").empty(); // Wipe the constraints pane
		$("section#categories").append('<h2>Constraints</h2>'); // Add header back in
		
		$.each(array, function(index, data) {

			// Load the relevant categories
			$("section#categories").append('<p id="' + data.categoryID + '"><img src="img/show.gif">&nbsp;' + data.categoryLabel + '</p>');
			$("section#categories").append('<p id="' + data.categoryID + 'Qs" class="helptext">' + data.guidingQs + '</p>');
			$("section#categories").append('<section id="' + data.categoryID + 'Constraints" class="derp"></section>');
					
			$("p#" + data.categoryID + "Qs").hide();
			$("section#" + data.categoryID + "Constraints").hide();
			
			$("p#" + data.categoryID).click(function(){
				$("section#" + data.categoryID + "Constraints").toggle(300);
				$("p#" + data.categoryID + "Qs").toggle(200);
			});		
		});	
		loadConstraints();			
	}
	
	function loadConstraints() {
		constraints = JSON.parse(localStorage.getItem('constraints'));
		$.each(constraints, function(index, d){
			$("section#" + d.categoryID + "Constraints").append('<img id="' + d.constraintID + '" src="' + d.imageLink + '" class="constraintImg" width="50px" height="80px">');
		});
	}
	
	// DEFAULT behavior for zero constraints selected
	if ($("section#userselected").is(":empty")) {
		$("section#userselected").html('<p id="noSelect">You haven\'t selected anything yet!</p>');
	}
	
	// ADD a constraint
	$("section.derp > img.constraintImg").click(function() {
		$("p#noSelect").remove();
		var id = $(this).attr("id");
		$("section#userselected").append($(this).clone().attr("id", id + "sel"));
		$("section#userselected").append('<button class="close">&times;</button>');
	});

	
	// REMOVE a constraint
	$("img.constraintImg").click(function() {
		alert('ok');
	});
	
});

</script>

	
	
				<script>
				
					var i=1;

					function addConstraint() {
						var clicked=document.getElementById(event.target.id);
					
						recommendations:{
							if (clicked.id=='foo2') {
								if (!confirm('This constraint has a recommendation. Add it anyway?')) {
								break recommendations;
								}
							} 
							
						var para=document.createElement("img");
						para.setAttribute("id", clicked.id + "sel");
						para.setAttribute("onclick", "removeConstraint()");
						para.setAttribute("width", "50px");
						para.setAttribute("height", "50px");
						para.src=clicked.src;

						i++;

						
						var div=document.getElementById("userselected");
						var p=document.getElementById("noSelect");
						
						if (p) {
							div.removeChild(p);
							}
						div.appendChild(para);

						if (clicked.id=='foo3') {
							var tech=document.getElementById("odk");
							tech.parentNode.removeChild(tech);
						}
						
							
						}
					}

					function removeConstraint() {
					
						var child=document.getElementById(event.target.id);
						var options=document.getElementById("tech");
						
						if (child.id=='foo3sel') {
							var tech=document.createElement("p");
							tech.setAttribute('id','odk');
							var node=document.createTextNode("ODK");
							tech.appendChild(node);
							options.appendChild(tech);
						}
					
						child.parentNode.removeChild(child);
						
						var div=document.getElementById("userselected");
						if (div.innerHTML.trim() == "") {
							div.innerHTML="<p id='noSelect'>You haven't selected anything yet!</p>";
						}
						
					}
					


				</script>


				

 </head>
 
<body class="border">

	<header class="border">
		<nav class="border">
			<ul class="nav">
				<li><a href="http://medicmobile.org" target="_blank">Medic Mobile Home</a> |&nbsp;</li>
				<li><a href="index.html">Toolkit Home</a></li>
				<li id="splitnav"><a href="">View Summary</a></li>
			</ul>
		</nav>
	</header>
	
	<!-- ************ BEGIN PAGE CONTENT ************ -->
	<section class="container">
	
		<!-- BEGIN first content row -->
		<section class="border">
		
			<!-- BEGIN (left side): drop down menu for system messaging type -->
			<section class="aside">
				<img id="selected" src="img/phone.png" width="350px"><button class="close" data-dropdown="#dropdown-1">&#9660;</button> <!-- 8711 -->
				
			</section>
			<!-- END drop down menu -->
			
			<!-- BEGIN (right side): title image/headline and user selected constraints-->
			<section class="asideoffset">
				<h1 class="constraints">Medic Mobile Tool Wizard</h1>
			</section>
			<!-- END (right side) -->
			
		</section>
		<!-- END first row of content -->
	
		<!-- BEGIN second row of content -->
		<section class="border">
		
			<!-- BEGIN CONSTRAINTS DRAWER (left side) -->
			<section id="categories" class="aside">
				<h2>Constraints</h2>
		
		


		
			</section>
			<!-- END CONSTRAINTS DRAWER -->
		
			<!-- BEGIN TECH OPTIONS (right side): change dynamically based on user selected constraints -->
			<section class="asideoffset">
			
				<!-- USER SELECTED CONSTRAINTS -->
				<section id="userselected"></section>
			
						
				<fieldset id="tech"><legend class="h2">My Tech Options</legend>		
					<p>Muvuku-Kujua</p>
					<p>Muvuku-Kujua-Lite</p>
					<p>Datawinners-Android</p>
					<p id="odk">ODK</p>
					
				</fieldset>
			</section>
			<!-- END tech options -->
		
		
		</section>
		<!-- END second row of content -->
		


	</section>
	<!-- ************ END PAGE CONTENT ************ -->
	

	<footer class="border">
		<!-- potentially add (c) info, etc. -->
	</footer>

	<!-- DROPDOWN UI, needs to remain immediately before </body> tag -->
	<div id="dropdown-1" class="dropdown dropdown-tip">
		<ul class="dropdown-menu">
			<li><img id="phone" class="selected" class="drop" src="img/phone.png" width="200px"></li>
			<li><img id="computer" class="deselected drop" src="img/computer.png" width="200px"></li>
			<li><img id="both" class="deselected drop" src="img/both.png" width="200px"></li>
		</ul>
	</div>	
</body>

</html>